<project_specification>
  <project_name>LifeOS (Echo/Lark) - Personal Operating System MVP</project_name>

  <overview>
    A single, end-to-end encrypted, WhatsApp-style application that serves as your personal operating system.
    Users chat with themselves and AI agents. All productivity tools (email, calendar, files, tasks) are
    accessible through conversational agents within the chat interface.

    **Current Status:** 70% complete - backend code exists, needs testing and completion
    **Immediate Goal:** Complete and test Stage 0 MVP (email agent working end-to-end)
  </overview>

  <existing_codebase>
    <location>/home/louisdup/Agents/lifeOS/echo-mvp</location>
    <backend>
      Path: /home/louisdup/Agents/lifeOS/echo-mvp/mastra-backend
      Framework: Node.js + Mastra + OpenAI GPT-4o-mini
      Port: 3001
      Status: Code complete, not tested yet
    </backend>
    <frontend>
      Path: /home/louisdup/Agents/lifeOS/echo-mvp/expo-app
      Framework: React Native (Expo) - iOS/Android/Web
      Status: Code complete, dependencies not installed
    </frontend>
    <environment>
      - OpenAI API key configured in .env
      - Node v22.20.0 installed
      - Gmail OAuth needs configuration
    </environment>
  </existing_codebase>

  <technology_stack>
    <backend>
      <runtime>Node.js v22.20.0</runtime>
      <framework>Mastra (AI agent framework)</framework>
      <ai_model>OpenAI GPT-4o-mini</ai_model>
      <email_integration>Gmail API (OAuth 2.0)</email_integration>
      <port>3001</port>
    </backend>
    <frontend>
      <framework>React Native with Expo</framework>
      <platforms>iOS, Android, Web (PWA)</platforms>
      <styling>NativeWind (Tailwind for React Native)</styling>
      <state>React hooks and context</state>
    </frontend>
    <security>
      <encryption>E2E encryption (planned)</encryption>
      <storage>Local-first (SQLite planned)</storage>
      <zero_knowledge>Server cannot read user data</zero_knowledge>
    </security>
  </technology_stack>

  <stage_0_mvp>
    <goal>Single-user personal OS with 3 core agents</goal>
    <timeline>Complete in 3-4 months</timeline>
    <target_metrics>
      <users>1,000 paying users</users>
      <mrr>$10,000 MRR</mrr>
      <retention>60% week-1 retention</retention>
      <pricing>$19/month subscription</pricing>
    </target_metrics>

    <core_agents>
      <agent name="@mail" priority="1" status="IN_PROGRESS">
        <description>Email management agent with Gmail integration</description>
        <capabilities>
          - Read recent emails
          - Search emails by query
          - Send emails
          - Get email summaries
          - Filter by unread/important
        </capabilities>
        <current_status>Backend code complete, needs testing</current_status>
        <next_steps>
          1. Fix port 3001 conflict
          2. Start backend server
          3. Get Gmail OAuth token
          4. Test email agent endpoints
          5. Verify end-to-end flow
        </next_steps>
      </agent>

      <agent name="@cal" priority="2" status="NOT_STARTED">
        <description>Calendar management with Google Calendar integration</description>
        <capabilities>
          - View upcoming events
          - Create new events
          - Update/cancel events
          - Find free time slots
          - Get daily/weekly summaries
        </capabilities>
      </agent>

      <agent name="@mem" priority="3" status="NOT_STARTED">
        <description>Personal memory and search agent</description>
        <capabilities>
          - Full-text search across all data
          - Store notes and thoughts
          - Retrieve past conversations
          - RAG-based context retrieval
          - Smart summaries
        </capabilities>
      </agent>
    </core_agents>
  </stage_0_mvp>

  <immediate_tasks>
    <priority>URGENT - Resume from Dec 5 pause</priority>
    <reference_doc>/home/louisdup/Agents/lifeOS/echo-mvp/START-MONDAY-DEC-9.md</reference_doc>

    <task order="1">
      <title>Fix Backend Startup</title>
      <steps>
        - Kill process on port 3001 (lsof -ti:3001 | xargs kill -9)
        - cd /home/louisdup/Agents/lifeOS/echo-mvp/mastra-backend
        - npm run api
        - Test: curl http://localhost:3001/health
      </steps>
      <expected_time>5 minutes</expected_time>
    </task>

    <task order="2">
      <title>Configure Gmail OAuth</title>
      <steps>
        - Go to https://developers.google.com/oauthplayground
        - Select Gmail API v1 scopes
        - Get access token
        - Add to .env file
        - Test email agent endpoint
      </steps>
      <expected_time>15 minutes</expected_time>
    </task>

    <task order="3">
      <title>Test Email Agent</title>
      <steps>
        - Test: curl http://localhost:3001/api/agents/mail
        - Verify Gmail connection
        - Test read emails
        - Test send email
        - Test search emails
      </steps>
      <expected_time>15 minutes</expected_time>
    </task>

    <task order="4">
      <title>Setup Frontend</title>
      <steps>
        - cd /home/louisdup/Agents/lifeOS/echo-mvp/expo-app
        - npm install (install all dependencies)
        - Update API endpoint to http://localhost:3001
        - npx expo start
      </steps>
      <expected_time>20 minutes</expected_time>
    </task>

    <task order="5">
      <title>End-to-End Testing</title>
      <steps>
        - Open Expo app in browser/simulator
        - Test chat interface
        - Send message to @mail agent
        - Verify email is fetched/sent
        - Test error handling
        - Document any bugs
      </steps>
      <expected_time>30 minutes</expected_time>
    </task>
  </immediate_tasks>

  <ui_requirements>
    <chat_interface>
      - WhatsApp-style message bubbles
      - Agent responses with typing indicator
      - Markdown support for formatted responses
      - @mention autocomplete for agents
      - Message timestamps
      - Error states clearly shown
    </chat_interface>

    <agent_interactions>
      - Type "@mail" to invoke email agent
      - Type "@cal" to invoke calendar agent
      - Type "@mem" to invoke memory agent
      - Agents respond with natural language
      - Action buttons for quick tasks
    </agent_interactions>

    <mobile_first>
      - Touch-optimized controls
      - Native keyboard handling
      - Offline-capable
      - Fast response times
      - Minimal data usage
    </mobile_first>
  </ui_requirements>

  <success_criteria>
    <phase_1_testing>
      - Backend server starts without errors
      - Health endpoint responds: {"status": "ok"}
      - Gmail OAuth token acquired successfully
      - Email agent can read real emails
      - Email agent can send test emails
    </phase_1_testing>

    <phase_2_integration>
      - Frontend connects to backend API
      - Chat interface renders properly
      - @mail agent responds to queries
      - Emails display correctly in UI
      - Send email workflow works end-to-end
    </phase_2_integration>

    <phase_3_polish>
      - Error messages are user-friendly
      - Loading states show properly
      - OAuth token refresh works
      - Offline mode shows clear status
      - Performance is acceptable (< 2s response)
    </phase_3_polish>
  </success_criteria>

  <known_issues>
    <issue priority="HIGH">
      <problem>Port 3001 already in use</problem>
      <solution>Kill existing process: lsof -ti:3001 | xargs kill -9</solution>
    </issue>

    <issue priority="MEDIUM">
      <problem>Gmail OAuth tokens expire hourly in dev mode</problem>
      <solution>Use refresh tokens, or re-auth each session during testing</solution>
    </issue>

    <issue priority="LOW">
      <problem>Expo dependencies not installed</problem>
      <solution>Run npm install in expo-app directory</solution>
    </issue>
  </known_issues>

  <next_agents_after_mvp>
    <agent name="@cal" timeline="Week 2-3">
      - Google Calendar integration
      - Event creation/management
      - Smart scheduling suggestions
    </agent>

    <agent name="@mem" timeline="Week 3-4">
      - SQLite database for notes
      - Full-text search
      - RAG-based retrieval
      - Conversation history
    </agent>

    <future_agents>
      - @task (todo management)
      - @travel (flight/hotel booking)
      - @finance (budget tracking)
      - @health (fitness/wellness)
    </future_agents>
  </next_agents_after_mvp>

  <deployment_plan>
    <phase name="Week 1">Complete @mail agent testing</phase>
    <phase name="Week 2-3">Add @cal and @mem agents</phase>
    <phase name="Week 4">Polish UI/UX, fix bugs</phase>
    <phase name="Month 2">TestFlight beta (100 users)</phase>
    <phase name="Month 3">Public launch (iOS App Store)</phase>
    <phase name="Month 4">Android launch (1,000 users)</phase>
  </deployment_plan>

  <business_model>
    <pricing>$19/month subscription (Solo tier)</pricing>
    <future_tiers>
      - Pro: $39/month (premium agents)
      - Team: $99/month (shared workspaces)
    </future_tiers>
    <target_revenue>
      - Month 3: $10k MRR (500 paying users)
      - Month 9: $200k MRR (10k users)
      - Month 18: $1M MRR (50k users)
    </target_revenue>
  </business_model>

  <principles>
    <privacy>E2E encryption, zero-knowledge server, local-first data</privacy>
    <quality>3 great agents > 10 mediocre ones</quality>
    <monetization>No ads, subscription-only</monetization>
    <user_control>No lock-in, export data anytime</user_control>
  </principles>
</project_specification>
